---
/**
 * ReadingProgress - Scroll progress indicator for articles
 * Shows reading progress as a gradient bar at the top of the viewport
 */
---

<div class="reading-progress" aria-hidden="true">
  <div class="reading-progress-bar"></div>
</div>

<style>
  .reading-progress {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    z-index: var(--z-tooltip);
    background: transparent;
    pointer-events: none;
  }

  .reading-progress-bar {
    height: 100%;
    width: 0%;
    background: var(--sip-gradient);
    transition: width 50ms ease-out;
    border-radius: 0 2px 2px 0;
  }
</style>

<script>
  function initReadingProgress() {
    const progressBar = document.querySelector('.reading-progress-bar') as HTMLElement
    if (!progressBar) return

    const article = document.querySelector('article')
    if (!article) {
      // Hide progress bar on non-article pages
      progressBar.parentElement!.style.display = 'none'
      return
    }

    function updateProgress() {
      const scrollTop = window.scrollY
      const docHeight = document.documentElement.scrollHeight - window.innerHeight
      const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0
      progressBar.style.width = `${Math.min(100, Math.max(0, progress))}%`
    }

    // Throttle scroll handler for performance
    let ticking = false
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateProgress()
          ticking = false
        })
        ticking = true
      }
    }, { passive: true })

    // Initial update
    updateProgress()
  }

  // Run on load
  initReadingProgress()

  // Run after view transitions
  document.addEventListener('astro:after-swap', initReadingProgress)
</script>
