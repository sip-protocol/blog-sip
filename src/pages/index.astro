---
import { getCollection } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import PostCard from '../components/PostCard.astro'
import { SITE_DESCRIPTION } from '../consts'

// Get all non-draft posts, sorted by date
const posts = (
  await getCollection('blog', ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true
  })
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())

// Get featured post (first featured or most recent)
const featuredPost = posts.find((p) => p.data.featured) || posts[0]
const remainingPosts = posts.filter((p) => p.id !== featuredPost?.id)
---

<BaseLayout>
  <section class="hero">
    <h1>SIP Protocol Blog</h1>
    <p class="hero-tagline">{SITE_DESCRIPTION}</p>
  </section>

  {
    featuredPost && (
      <section class="featured">
        <h2 class="section-title">Featured</h2>
        <PostCard
          title={featuredPost.data.title}
          description={featuredPost.data.description}
          pubDate={featuredPost.data.pubDate}
          heroImage={featuredPost.data.heroImage}
          slug={featuredPost.id}
          category={featuredPost.data.category}
          tags={featuredPost.data.tags}
          featured={true}
        />
      </section>
    )
  }

  <section class="posts">
    <h2 class="section-title">Latest Posts</h2>
    <div class="post-grid">
      {
        remainingPosts.map((post) => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            heroImage={post.data.heroImage}
            slug={post.id}
            category={post.data.category}
            tags={post.data.tags}
          />
        ))
      }
    </div>
  </section>

  {
    posts.length === 0 && (
      <section class="empty">
        <p>No posts yet. Check back soon!</p>
      </section>
    )
  }
</BaseLayout>

<style>
  .hero {
    text-align: center;
    padding: 2rem 0 3rem;
  }

  .hero h1 {
    font-size: 2.5rem;
    margin: 0 0 0.75rem;
    background: linear-gradient(
      135deg,
      var(--sip-primary),
      var(--sip-accent)
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-tagline {
    font-size: 1.125rem;
    color: rgb(var(--gray));
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .section-title {
    font-size: 1.5rem;
    margin: 0 0 1.5rem;
    color: rgb(var(--black));
  }

  .featured {
    margin-bottom: 3rem;
  }

  .posts {
    margin-bottom: 3rem;
  }

  .post-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
  }

  .empty {
    text-align: center;
    padding: 4rem 0;
    color: rgb(var(--gray));
  }

  @media (max-width: 768px) {
    .hero h1 {
      font-size: 2rem;
    }

    .hero-tagline {
      font-size: 1rem;
    }

    .post-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
